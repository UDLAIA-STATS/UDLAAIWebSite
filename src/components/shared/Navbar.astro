---
import "@styles/global.css";
import { getNavbarLinks, navbarLinks } from "@consts/navbar-links";
import LogoUdla from "@assets/logo_udla_corto.png";
import type { User } from "@interfaces/user.interface";
import VerticalChevron from "@assets/vertical_chevron.svg";
export const prerender = false;

const currentPath = Astro.url.pathname;
const user  = Astro.cookies.get("user") ? JSON.parse(Astro.cookies.get("user")?.value as string) as User : null;
const links = getNavbarLinks(user as User);
console.log({user});
console.log({links});
---

<section class="w-full relative top-0 right-0 left-0">
  <nav class="bg-[#C10230] px-1 py-4 flex w-full">
    <div class="flex justify-start ml-10">
      <a href="/" class="flex items-center no-underline">
        <img src={LogoUdla.src} alt="Logo UDLA" class="h-8" />
      </a>
    </div>
    <div class="flex flex-grow justify-center mr-10 align-middle">
      <ul class="flex gap-5 list-none m-0 p-0">
        {
          links.map(({ href, name }) => (
            <div>
              <a
                href={href}
                class:list={[
                  "text-white no-underline text-base px-3 pb-1",
                  {
                    "text-white/75 hover:text-white hover:border-b-2 hover": !(href === currentPath),
                  } 
                ]}>
                {name}
              </a>
              {
                currentPath === href && (
                  <div 
                  transition:name="menu-line"
                  class="text-white border-b-2 border-white pb-1" />
                )
              }
            </div>
          ))
        }
      </ul>
    </div>
    <div
    class="flex justify-end mr-5 w-fit px-5">
    <div class="flex flex-col text-white justify-center align-middle items-center cursor-pointer pb-1">
      <button class="flex no-underline" id="showMenu">
        <span class="flex pr-2">{user ? `Hola, ${user.nickname}` : "Bienvenido"}</span>
        <div class:list={[
          "flex items-center align-middle justify-center rotate-180",
        ]}>
          <img src={VerticalChevron.src} alt="Icono de flecha" class=`h-4 w-4 ${user ? "" : "hidden"}`  />
        </div>
      </button>
      <div id="menu" class="hidden bg-white text-black absolute top-12 right-5 rounded-md shadow-lg z-0 w-40">
        <ul class="flex flex-col gap-2 list-none m-0 p-0">
              <button
                id="logout"
                class:list={[
                  "text-base px-3 pb-1 cursor-pointer",
                ]}>
                Logout
              </button>
        </ul>
      </div>
    </div>
    
  </div>
</nav>
</section>

<script>
import { actions } from "astro:actions";
import { publicRoutesMap } from "@consts/routes"

  const btnShowMenu = document.getElementById("showMenu") as HTMLButtonElement;
  const btnLogout = document.getElementById("logout") as HTMLButtonElement;

  const menu = document.getElementById("menu");
  let showMenu = false;

  btnShowMenu.addEventListener("click", () => {
    showMenu = !showMenu;
    if (showMenu) {
      menu?.classList.remove("hidden");
    } else {
      menu?.classList.add("hidden");
    }
  });

  btnLogout.addEventListener("click", async () => {
    await actions.logout(null);
    window.location.replace(publicRoutesMap.HOME);
  });
  </script>