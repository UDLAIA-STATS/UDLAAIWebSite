---
import "@styles/global.css";
import arrowNext from "@assets/arrow_next.svg";
import FormLayout from "@layouts/FormLayout.astro";
import { actions } from "astro:actions";
import type { Player } from "@interfaces/index";
import NotFoundImage from "@assets/not_found.svg";
import { Input, ComboBox, FormButtons } from "@components/molecules/forms/index";

const buttonClass =
  "text-[#C10230] bg-white border-[#C10230] border-solid border-2 px-4 py-2 rounded-md flex items-center justify-center cursor-pointer transition";
const inputClass =
  "bg-white text-black rounded-md p-2 w-md focus:outline-none focus:ring-2 focus:ring-[#C10230]";

const user = Astro.cookies.get("user")
  ? (JSON.parse(Astro.cookies.get("user")?.value as string) as LoggedUser)
  : null;

const { idBanner } = Astro.params;
const { data, error } = await Astro.callAction(actions.getJugadorByBanner, {
  idJugador: idBanner ?? "",
});

if (error || !data) {
  console.error("Error al obtener jugador:", error);
  throw new Error("No se pudo cargar la información del jugador.");
}

const jugador = data.data as Player;
const logoJugador = jugador.imagenjugador ?? null;
console.log(logoJugador);
---

<FormLayout
  user={user}
  formTitle="Editar Jugador"
  pageTitle="Actualizar Jugador"
>
  <form id="formJugador" class="flex flex-col w-full max-w-md">
    <!-- ID Banner -->
    <Input
      id="idjugador"
      label="ID Jugador"
      value={jugador.idjugador.toString()}
      hidden
    />

    <Input
      id="idbanner"
      label="ID Banner"
      minlength={9}
      maxlength={9}
      value={jugador.idbanner}
      required
    />

    <!-- Nombres -->
    <Input
      id="nombrejugador"
      label="Nombres"
      maxlength={100}
      value={jugador.nombrejugador}
      required
    />

    <!-- Apellidos -->
    <Input
      id="apellidojugador"
      label="Apellidos"
      maxlength={100}
      value={jugador.apellidojugador}
      required
    />

    <!-- Número de camiseta -->
    <Input
      id="numerocamisetajugador"
      label="Número de Camiseta"
      type="number"
      maxlength={2}
      minlength={1}
      value={jugador.numerocamisetajugador}
      required
    />

    <!-- Posición -->
    <ComboBox id="posicionjugador" label="Posición" required>
      <option value="">-- Selecciona --</option>
      <option value="Portero" selected={jugador.posicionjugador === "Portero"}
        >Portero</option
      >
      <option value="Defensa" selected={jugador.posicionjugador === "Defensa"}
        >Defensa</option
      >
      <option
        value="Mediocampista"
        selected={jugador.posicionjugador === "Mediocampista"}
        >Mediocampista</option
      >
      <option
        value="Delantero"
        selected={jugador.posicionjugador === "Delantero"}>Delantero</option
      >
    </ComboBox>

    <!-- Jugador activo -->
    <ComboBox id="jugadoractivo" label="Jugador Activo" required>
      <option value="" disabled>-- Selecciona --</option>
      <option value="true" selected={jugador.jugadoractivo === true}
        >Activo</option
      >
      <option value="false" selected={jugador.jugadoractivo === false}
        >Inactivo</option
      >
    </ComboBox>
    <!-- <Input
      id="imagenjugador"
      label="Foto de la camiseta (opcional)"
      type="file"
      accept="image/*"
    />
    {
      logoJugador && (
        <div class="flex flex-col items-start mb-4">
          <label class="text-base font-medium mb-2">
            Foto actual de la camiseta
          </label>
          <img
            src={logoJugador ?? NotFoundImage.src}
            alt="Foto del jugador"
            class="w-fit h-fit object-cover rounded-lg shadow-md border"
          />
        </div>
      )
    } -->

    <!-- Botón -->
    <FormButtons label="Actualizar Jugador" />
  </form>
</FormLayout>

<script src="./scripts/edit.ts"/>